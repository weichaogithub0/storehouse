"use strict";!function(){if(getcookie("cookiesid")&&getcookie("cookienum")){var t=getcookie("cookiesid").split(","),n=getcookie("cookienum").split(",");$.each(t,function(i,e){!function(n,c){$.ajax({url:"../php/jialefudata.php",dataType:"json"}).done(function(i){$.each(i,function(i,e){if(n==e.sid){var t=$(".clone").clone(!0,!0);t.find(".img").find("img").attr("src",e.url),t.find(".img").find("img").attr("sid",e.sid),t.find(".infor").html(e.title),t.find(".price").html("￥"+e.price1+"."+e.price2),t.find(".num").val(c),t.find(".aprice").html("￥"+(c*Number(e.price1+"."+e.price2)).toFixed(2)),t.find(".weight").html(c*Number(e.title.slice(-4,-1)).toFixed(2)+"g"),t.css("display","block"),t.removeClass("clone"),$(".list").append(t)}}),o()})}(t[i],n[i])})}function o(){var t=0,n=0,c=0;$(".list>li").each(function(i,e){$(e).find(".cart-checkbox").prop("checked")&&(t+=Number($(e).find(".cart-checkbox").parent().find(".aprice").html().substring(1)),n+=Number($(e).find(".cart-checkbox").parent().find(".weight").html().slice(0,-1)),c+=Number($(e).find(".cart-checkbox").parent().find(".num").val()))}),$(".all li:nth-child(1) span").html("￥"+t.toFixed(2)),$(".all li:nth-child(4) span").html(n+"g"),$(".all li:nth-child(3) span").html("￥"+t.toFixed(2)),$(".bar-right i").html(" "+c+" 件")}$(".allsel").on("change",function(){$(".list>li:visible").find(":checkbox").prop("checked",$(this).prop("checked")),$(".allsel").prop("checked",$(this).prop("checked")),o()});var i=$(".list>li:visible").find(":checkbox");function e(i){return"￥"+(Number(i.parent().find(".num").val())*Number(i.parent().children(".price").html().substring(1))).toFixed(2)}function c(i){return Number(i.parent().find(".num").val())*Number(i.parent().children(".infor").html().slice(-4,-1)).toFixed(2)+"g"}$(".list").on("change",i,function(){$(".list>li:visible").find("input:checkbox").length==$(".list>li:visible").find("input:checked").size()?$(".allsel").prop("checked",!0):$(".allsel").prop("checked",!1),o()}),$(".add").on("click",function(){var i=Number($(this).next().val());99<=++i&&(i=99),$(this).next().val(i),$(this).parent().children(".aprice").html(e($(this))),$(this).parent().children(".weight").html(c($(this))),o(),s($(this))}),$(".reduce").on("click",function(){var i=Number($(this).prev().val());--i<=1&&(i=1),$(this).prev().val(i),$(this).parent().children(".aprice").html(e($(this))),$(this).parent().children(".weight").html(c($(this))),o(),s($(this))}),$(".num").on("input",function(){var i=parseInt($(this).val());/^\d+$/g.test(i)?99<=i?$(this).val(99):i<=0?$(this).val(1):$(this).val(i):$(this).val(1),$(this).parent().children(".aprice").html(e($(this))),$(this).parent().children(".weight").html(c($(this))),o(),s($(this))});var l=[],r=[];function h(){getcookie("cookiesid")&&getcookie("cookienum")&&(l=getcookie("cookiesid").split(","),r=getcookie("cookienum").split(","))}function s(i){h();var e=i.parent().find(".img").find("img").attr("sid");r[$.inArray(e,l)]=i.parent().find(".num").val(),addcookie("cookienum",r.toString(),10)}function a(t,i){var n=-1;$.each(i,function(i,e){t===e&&(n=i)}),i.splice(n,1),r.splice(n,1),addcookie("cookiesid",i.toString(),10),addcookie("cookienum",r.toString(),10)}function d(){getcookie("cookiesid")&&getcookie("cookienum")?$(".empty").hide():$(".empty").show()}$(".list").on("click",".del",function(){h(),a($(this).parent().find(".img").find("img").attr("sid"),l),$(this).parent().remove(),o(),d()}),$("#del").on("click",function(){h(),confirm("确定删除吗亲？")&&$(".list li:visible").each(function(){$(this).find(".cart-checkbox").is(":checked")&&($(this).remove(),a($(this).find(".img").find("img").attr("sid"),l))}),o(),d()}),d()}();